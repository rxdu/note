{"componentChunkName":"component---node-modules-rocketseat-gatsby-theme-docs-core-src-templates-docs-query-js","path":"/tech-notes/system/raspberrypi/raspberrypi-cross-chroot-docker","result":{"data":{"mdx":{"id":"78920a1b-40d7-532d-9a99-e107595f3df3","excerpt":"Natively compiling a medium to large project could take a long time on Raspberry Pi. In this case, setting up cross-compiling on your host computer and do theâ€¦","fields":{"slug":"/tech-notes/system/raspberrypi/raspberrypi-cross-chroot-docker/"},"frontmatter":{"title":"Use Chroot and Docker for ARM Application Development","description":"cross-compile","image":null,"disableTableOfContents":null},"body":"var _excluded = [\"components\"];\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\nvar _frontmatter = {\n  \"title\": \"Use Chroot and Docker for ARM Application Development\",\n  \"description\": \"cross-compile\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n    props = _objectWithoutProperties(_ref, _excluded);\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Natively compiling a medium to large project could take a long time on Raspberry Pi. In this case, setting up cross-compiling on your host computer and do the hard work on a more powerful desktop CPU could significantly reduce the build time.\"), mdx(\"h2\", {\n    \"id\": \"install-tools\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#install-tools\",\n    \"aria-label\": \"install tools permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Install Tools\"), mdx(\"p\", null, \"First install the following dependencies in order to run binaries built for arm platforms on an x86_64 computer:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ sudo apt install qemu qemu-user-static binfmt-support\\n\")), mdx(\"p\", null, \"You can read more about how this works in \", \"[3]\", \" and even more details from the QEMU project website. Briefly, the setup works as follows\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"arm applications\\n        |\\n        v\\nQEMU arm emulator \\n        |\\n        v\\n host OS (x86_64) \\n        |\\n        v\\nhost hardware (x86_64) \\n\")), mdx(\"h2\", {\n    \"id\": \"setup-chroot-with-sd-card\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#setup-chroot-with-sd-card\",\n    \"aria-label\": \"setup chroot with sd card permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Setup chroot with SD Card\"), mdx(\"p\", null, \"With the above tools, you can now mount the file system on your Raspberry Pi SD card to your host computer and chroot into it. \"), mdx(\"p\", null, \"Note here it's assumed the SD card has been setup correctly beforehand. You can flash the Raspberry Pi OS as usual to the SD card and make sure you run the initial setup on the Pi board to expand the file system to the whole SD card. Then you can remove the SD card and connect it to to your computer (with a SD to USB adapter). You need to identify the sd card drive name appeared in your computer\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ lsblk\\n\")), mdx(\"p\", null, \"Here I have a SD card with the official Raspberry Pi OS installed, and it appeared as \\\"/dev/sdc\\\"\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"530px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"11.249999999999998%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAdElEQVQI1z2NOQ7DMAwEqcNMKOiAGkuK5cop4v8/cAOxcEGQWCxn6HffEHnDWgsignMOvXcwb/DeI+eM1hpEBL031Fr1TikhhIAYo44xRv/pur5o+44XswYLMsYAM8P7DaWUB3gcHwUu4XlO3as751TBAv4BU3YuggSunfMAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"picture\", {\n    parentName: \"span\"\n  }, \"\\n          \", mdx(\"source\", {\n    parentName: \"picture\",\n    \"srcSet\": [\"/static/5db7a95713677923b5e166b12fcc670f/8ac56/chroot-sd-card.webp 240w\", \"/static/5db7a95713677923b5e166b12fcc670f/d3be9/chroot-sd-card.webp 480w\", \"/static/5db7a95713677923b5e166b12fcc670f/c2b64/chroot-sd-card.webp 530w\"],\n    \"sizes\": \"(max-width: 530px) 100vw, 530px\",\n    \"type\": \"image/webp\"\n  }), \"\\n          \", mdx(\"source\", {\n    parentName: \"picture\",\n    \"srcSet\": [\"/static/5db7a95713677923b5e166b12fcc670f/8ff5a/chroot-sd-card.png 240w\", \"/static/5db7a95713677923b5e166b12fcc670f/e85cb/chroot-sd-card.png 480w\", \"/static/5db7a95713677923b5e166b12fcc670f/b6a9b/chroot-sd-card.png 530w\"],\n    \"sizes\": \"(max-width: 530px) 100vw, 530px\",\n    \"type\": \"image/png\"\n  }), \"\\n          \", mdx(\"img\", {\n    parentName: \"picture\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"src\": \"/static/5db7a95713677923b5e166b12fcc670f/b6a9b/chroot-sd-card.png\",\n    \"alt\": \"SD Card\",\n    \"title\": \"SD Card\",\n    \"loading\": \"lazy\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    }\n  }), \"\\n        \"), \"\\n    \")), mdx(\"p\", null, \"There is a script from Github that you can use to easily setup the chroot \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://gist.github.com/htruong/7df502fb60268eeee5bca21ef3e436eb\"\n  }, \"\\\"chroot-to-pi.sh\\\"\"), \":\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ sudo ./chroot-to-pi.sh /dev/sdc\\n\")), mdx(\"p\", null, \"I copy the content of the script here just to show what has been done by the script: it first mounts the partitions on the SD card to the host system at /mnt/raspbian and then chroot to this folder. Finally it will do the cleanup work for you after you finish the work in the chroot environment.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"mkdir -p /mnt/raspbian\\n\\n# mount partition\\nmount -o rw ${1}2  /mnt/raspbian\\nmount -o rw ${1}1 /mnt/raspbian/boot\\n\\n# mount binds\\nmount --bind /dev /mnt/raspbian/dev/\\nmount --bind /sys /mnt/raspbian/sys/\\nmount --bind /proc /mnt/raspbian/proc/\\nmount --bind /dev/pts /mnt/raspbian/dev/pts\\n\\n# ld.so.preload fix\\nsed -i 's/^/#CHROOT /g' /mnt/raspbian/etc/ld.so.preload\\n\\n# copy qemu binary\\ncp /usr/bin/qemu-arm-static /mnt/raspbian/usr/bin/\\n\\necho \\\"You will be transferred to the bash shell now.\\\"\\necho \\\"Issue 'exit' when you are done.\\\"\\necho \\\"Issue 'su pi' if you need to work as the user pi.\\\"\\n\\n# chroot to raspbian\\nchroot /mnt/raspbian /bin/bash\\n\\n# ----------------------------\\n# Clean up\\n# revert ld.so.preload fix\\nsed -i 's/^#CHROOT //g' /mnt/raspbian/etc/ld.so.preload\\n\\n# unmount everything\\numount /mnt/raspbian/{dev/pts,dev,sys,proc,boot,}\\n\")), mdx(\"h2\", {\n    \"id\": \"buildrun-docker-image-for-arm-platform-on-x86-computer\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#buildrun-docker-image-for-arm-platform-on-x86-computer\",\n    \"aria-label\": \"buildrun docker image for arm platform on x86 computer permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Build/Run Docker Image for Arm Platform on x86 Computer\"), mdx(\"p\", null, \"Install the docker engine by following instructions \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.docker.com/engine/install/ubuntu/\"\n  }, \"here\"), \".\"), mdx(\"p\", null, \"You can check the architecture of your system using uname command. \"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"uname -m\\n\")), mdx(\"p\", null, \"On you host computer, you should get a string \\\"x86_64\\\". But if you try to run a docker image built for arm platform, you will get execution errors. \"), mdx(\"p\", null, \"To make this work, you need to run the following docker image, in addition to installing the above tools:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"sudo docker run --rm --privileged multiarch/qemu-user-static --reset -p yes\\n\")), mdx(\"p\", null, \"You can get more details about \\\"qemu-user-static\\\" from its Github page \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/multiarch/qemu-user-static\"\n  }, \"here\"), \". Now you should be able to build or run docker image for Arm platforms. Note you will need to find a proper base image, e.g. nvcr.io/nvidia/l4t-base:r32.6.1 for a Nvidia Jetson board. Refer to \", \"[3]\", \" for a more detailed example. \"), mdx(\"h2\", {\n    \"id\": \"reference\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#reference\",\n    \"aria-label\": \"reference permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Reference\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"[1]\", \" \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://www.j1nx.nl/diy/crosscompiling-software-for-raspbian-in-a-chroot-environment/\"\n  }, \"https://www.j1nx.nl/diy/crosscompiling-software-for-raspbian-in-a-chroot-environment/\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"[2]\", \" \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://gist.github.com/htruong/7df502fb60268eeee5bca21ef3e436eb\"\n  }, \"https://gist.github.com/htruong/7df502fb60268eeee5bca21ef3e436eb\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"[3]\", \" \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://www.stereolabs.com/docs/docker/building-arm-container-on-x86/\"\n  }, \"https://www.stereolabs.com/docs/docker/building-arm-container-on-x86/\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"[4]\", \" \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://github.com/multiarch/qemu-user-static\"\n  }, \"https://github.com/multiarch/qemu-user-static\"))));\n}\n;\nMDXContent.isMDXComponent = true;","headings":[{"depth":2,"value":"Install Tools"},{"depth":2,"value":"Setup chroot with SD Card"},{"depth":2,"value":"Build/Run Docker Image for Arm Platform on x86 Computer"},{"depth":2,"value":"Reference"}]}},"pageContext":{"slug":"/tech-notes/system/raspberrypi/raspberrypi-cross-chroot-docker/","next":{"label":"Back to Main Page","link":"https://rdu.im"},"repositoryEditUrl":"https://github.com/rxdu/note/tree/main/src/docs/tech-notes/system/raspberrypi/raspberrypi-cross-chroot-docker.mdx","repositoryProvider":"GitHub"}},"staticQueryHashes":["1954253342","2328931024","2501019404","973074209"]}